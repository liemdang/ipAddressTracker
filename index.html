<!DOCTYPE html> 

<html lang="en"> 
<head> 
    <meta charset="UTF-8"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" 
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" 
    crossorigin=""/> 

    <link rel="stylesheet" href="style.css" /> 
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" 
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" 
        crossorigin=""></script> 
    <title>IP Address Tracker</title> 
</head> 
<body> 
    <div class="container">
        <div class="header_bg"> 
            <h2 class="header_title">IP Address Tracker</h2>
            <form class="header_input_container">
                <input id="input_id" class="header_input" placeholder="Search for any IP address or domain"></input>
                <button type="submit" class="header_send">
                    <svg xmlns="http://www.w3.org/2000/svg" width="11" height="14"><path fill="none" stroke="#FFF" stroke-width="3" d="M2 1l6 6-6 6"/></svg>
                </button>
            </form>
            <div class="header_info">
                <div class="info_container" id="firstinfo">
                    <p class="info_title">ip address</p>
                    <h3 class="info_value" id="ip_id"></h3>
                </div>
                <div class="info_container">
                    <p class="info_title">location</p>
                    <h3 class="info_value" id="location_id"></h3>
                </div>
                <div class="info_container">
                    <p class="info_title">timezone</p>
                    <h3 class="info_value" id="timezone_id"></h3>
                </div>
                <div class="info_container">
                    <p class="info_title">Isp</p>
                    <h3 class="info_value" id="isp_id"></h3>
                </div>
            </div>
            </div>
        <div id="mapid"></div> 
    </div>
    
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script> 
    <script type="text/javascript"> 

const api_key = "at_QJZHIyDJgJj9tCF3ZhIlwwPVUe0Ir"; 
let infoContainer = document.querySelector(".header_info")

let input = document.querySelector(".header_input_container")
let ipInfo = document.getElementById("ip_id")
let locationInfo = document.getElementById("location_id")
let timezoneInfo = document.getElementById("timezone_id")
let ispInfo = document.getElementById("isp_id")
let mymap

input.addEventListener("submit", function(event) {
    event.preventDefault()
    loadIpData()
});
    function loadIpData() {
        let sObject = {}
        let ipValue
        if(mymap !== undefined) {
            mymap.remove();
            ipValue = input[0].value
        } else {
            ipValue = "192.212.174.101"
        }
        $(function () { 
           $.ajax({ 
               url: "https://geo.ipify.org/api/v1", 
               data: {apiKey: api_key, ipAddress: ipValue, domain: ipValue}, 
               success: function(data) { 
                    sObject = JSON.stringify(data,"",2)
                    
                setTimeout(function(){ 
                    let myObj = JSON.parse(sObject)
                    ipInfo.innerHTML = myObj.ip; 
                    locationInfo.innerHTML = `${myObj.location.city}, ${myObj.location.region} ${myObj.location.postalCode}`; 
                    timezoneInfo.innerHTML = myObj.location.timezone;
                    ispInfo.innerHTML = myObj.isp
                    
                    mymap = L.map('mapid').setView([myObj.location.lat, myObj.location.lng], 17); 
            
                L.tileLayer(`https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}`, {
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                    maxZoom: 18,
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1,
                    accessToken: 'pk.eyJ1IjoibGllbTkxIiwiYSI6ImNrcHh1OHN4bTAxYXAyb3JyczJrcmg5Y3MifQ.uchYUbWz84KPtY5nrv7HfA'
                }).addTo(mymap);
                        let marker = L.marker([myObj.location.lat, myObj.location.lng]).addTo(mymap);
                        }, 1000);
                    }
                });
                }); 
        }
        loadIpData()
        
    </script> 

</body> 

</html> 